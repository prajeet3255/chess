<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="pragma" content="no-cache" />
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://scheduler.distributed.computer/dcp-client/dcp-client.js"></script>
    <script type="module">
      const { compute } = dcp;

      function addJobEventListeners(job) {
        job.on("readystatechange", (event) => {
          console.log(`New ready state: ${event}`);
        });

        job.on("accepted", () => {
          console.log(`Job accepted by scheduler, waiting for results...`);
          console.log(`Job has id ${job.id}`);
        });

        job.on("console", (event) => {
          console.log("Job console event:", event.message);
        });

        job.on("result", ({ sliceNumber, result }) => {
          console.log(`Received result for slice ${sliceNumber}:`, result);
          console.log(
            "-----------------------------------------------------------------------------\n"
          );
        });
        job.on("complete", (complete) =>
          console.log(`Job completed ${complete.length} slices`)
        );
        job.on("error", (error) => console.log(error));
        job.on("status", (status) => console.log("Status:", status));
      }

      async function deploy() {
        const inputSet = [];
        for (let i = 0; i < 100; i++) {
          inputSet.push(i);
        }

        async function workFunction(_input, depth) {
          progress(0);

          return { result: i, movePlayed: depth };
        }

        const job = compute.for(inputSet, workFunction, [100]);
        addJobEventListeners(job);
        job.public.name = "Distributed Chess Engine";
        job.public.description = "Making pro-level analysis more accessible";
        job.public.link = "https://github.com/SophiaPerzan/JS-Chess";
        job.estimationSlices = Infinity;
        job.greedyEstimation = true;
        job.requires("dcp-chess/chess.js");
        job.computeGroups = [{ joinKey: "insight", joinSecret: "dcp" }];

        const moveScores = await job.exec(0.005);
        //const moveScores = await job.localExec(31);
      }

      window.deploy = deploy;
    </script>
  </head>
  <body>
    <input type="button" id="deploy" value="Deploy" onclick="deploy()" />
  </body>
</html>
